# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild
# Author: Denis Kristak
easyblock = 'CMakeMake'

name = 'Brunsli'
version = '0.1'

homepage = 'https://github.com/google/brunsli/'
description = """Brunsli is a lossless JPEG repacking library."""

toolchain = {'name': 'GCCcore', 'version': '10.2.0'}

source_urls = ['https://github.com/google/brunsli/archive/']
sources = ['v%(version)s.tar.gz']
patches = ['Brunsli-0.1_wrong_paths.patch']
checksums = [
    '62762dc740f9fcc9706449c078f12c2a366416486d2882be50a9f201f99ac0bc',  # v0.1.tar.gz
    '34795a1adba1ec208033922eaf27b3b3a23535a2e09201f93f9098666dd7319d',  # Brunsli-0.1_wrong_paths.patch
]

builddependencies = [
    ('CMake', '3.18.4'),
    ('binutils', '2.35'),
]

dependencies = [
    ('Brotli', '1.0.9'),
    ('Highway', '0.12.2'),
]

configopts = ' -DCMAKE_BUILD_TYPE=Release '
configopts += ' -DCMAKE_CXX_FLAGS="$CXXFLAGS -lbrotlienc -lbrotlidec -lbrotlicommon "'

postinstallcmds = [
    'mkdir %(installdir)s/bin ',
    'cp dbrunsli %(installdir)s/bin ',
    'cp *.a %(installdir)s/lib64 ',
    'cp *.so %(installdir)s/lib64 ',
]

sanity_check_paths = {
    'files': ['bin/dbrunsli'],
    'dirs': ['bin'],
}

sanity_check_commands = ['dbrunsli 2>&1 | grep Usage']

moduleclass = 'lib'
