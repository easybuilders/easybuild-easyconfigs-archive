easyblock = "ConfigureMake"

name = 'SMARTdenovo'
version = '20180219'

homepage = 'https://github.com/ruanjue/smartdenovo'
description = """SMARTdenovo is a de novo assembler for PacBio and
Oxford Nanopore (ONT) data. It produces an assembly from all-vs-all raw
read alignments without an error correction stage. It also provides
tools to generate accurate consensus sequences, though a platform
dependent consensus polish tools (e.g. Quiver for PacBio or Nanopolish
for ONT) are still required for higher accuracy."""

toolchain = {'name': 'foss', 'version': '2018b'}

commit = '5cc1356bffb87197b0fb9b835cfe1adc5a764dc6'
sources = [{
    'filename': '%%(name)s-master-20190215-%s.tar.gz' % commit,
    'git_config': {
        'url': 'https://github.com/ruanjue',
        'repo_name': 'smartdenovo',
        'commit': commit,
    }
}]
patches = [
    '%(name)s-%(version)s_fix_build_flags_and_install.patch',
    '%(name)s-%(version)s_use_env_perl_for_startup.patch',
]
checksums = [
    # SMARTdenovo-master-20190215-5cc1356bffb87197b0fb9b835cfe1adc5a764dc6.tar.gz
    'd1dc8b0f1ba19cbdf2572f29c91d57d4b7b75508ad6ef4eca39ecc7db049c544',
    # SMARTdenovo-20180219_fix_build_flags_and_install.patch
    '6138fb6db730372ee50a5cc87cadf2d99f11b48165e45832eb985804910d2420',
    # SMARTdenovo-20180219_use_env_perl_for_startup.patch
    'e9ee4d00f977b0c8694fffb15b9fbf7d3aa575b71f3adb979f9203c48c1ee22c',
]

# Checksum will probably not match since the tar file is generated on the fly.

dependencies = [('Perl', '5.28.0')]

skipsteps = ['configure']

installopts = ' INSTALLDIR=%(installdir)s '

sanity_check_paths = {
    'files': ['bin/%s' % x for x in ['dbm_index_fa.pl', 'dbm_read_fa.pl',
                                     'fq2fa.pl', 'large_seqs.pl',
                                     'longest_pacbio_subreads_f5q.pl',
                                     'longest_pacbio_subreads.pl', 'pairaln',
                                     'pbcluster_haplo.pl', 'pbcluster_upgma.pl',
                                     'rename_fa.pl', 'rename_fq.pl',
                                     'run_dmo.sh', 'run_zmo.sh', 'seq_n50.pl',
                                     'smartdenovo.pl', 'wtclp', 'wtcns',
                                     'wtcyc', 'wtext', 'wtgbo', 'wtlay',
                                     'wtmer', 'wtmsa', 'wtobt', 'wtpre', 'wtzmo']],
    'dirs': [],
}

moduleclass = 'bio'
